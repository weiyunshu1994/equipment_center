[toc]

# 设备管理系统

## 1. 主要功能

- **设备注册功能**：设备在首次使用时，需要在云端进行注册，数据库中创建设备信息。
- **设备信息上报**：设备能够将信息上报给云端，存入设备数据库当中。
- **云端发送信息给设备**：云端能够发送信息给设备
- **设备状态的实时通知**：云端能够实时获取设备的在线状态

## 2. 设备数据库的设计

![设备表单](https://weiyunshu1994-picgo-img.oss-cn-shenzhen.aliyuncs.com/Typora_%E6%9C%AA%E5%91%BD%E5%90%8D%E6%96%87%E4%BB%B6%20(4).png)

```sql
CREATE TABLE 'equipment'(
	'id' int(11) NOT NULL AUTO_INCREMENT COMMENT 'ID',
    'sn' varchar(32) NOT NULL COLLATE utf8mb4_bin COMMENT '设备序列号',
    'version' varchar(32) COLLATE utf8mb4_bin DEAFAULT NULL COMMENT '设备当前版本号',
    'status' BOOLEAN DEFAULT '0' COMMENT '设备在线状态',
    'disable' BOOLEAN DEFAULT '1' COMMENT '设备是否禁用',
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin COMMENT='设备表';
```

## 3.  实现方案

- 设备端向云端发送消息，主要采用http的方式
- 云端向设备端则采用消息队列的通信方式

### 3.1 设备端向云端发送消息接口设计

|                    | method | URL                  |
| ------------------ | ------ | -------------------- |
| 设备创建           | POST   | v1/equipment         |
| 设备向云端发送消息 | POST   | v1/equipment/message |

### 3.2 云端向设备端发送消息接口设计

